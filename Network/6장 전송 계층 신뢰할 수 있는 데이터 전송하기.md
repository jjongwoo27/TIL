# 6장 전송 계층: 신뢰할 수 있는 데이터 전송하기

생성일: 2022년 1월 10일 오후 3:50
태그: 모두의Network

# 전송 계층의 역할

- 전송 계층은 목적지에 신뢰할 수 있는 데이터를 전달하기 위해 필요
    - 오류를 점검하고 오류가 발생할 때 데이터를 재전송하도록 요청
    - 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별
    
    → 데이터를 목적지에 문제 없이 전달하고(신뢰성/정확성) 데이터를 빠르고 효율적으로 전달하기(효율성)
    
- 연결형 통신: 신뢰할 수 있고 정확한 데이터를 전달하는 통신
    - 상대편과 확인해 가면서 통신하는 방식 (신뢰성/정확성 우선)
    - 주로 활용
    - TCP(Transmission Control Protocol) 프로토콜
- 비연결형 통신: 효율적으로 데이터를 전달하는 통신
    - 상대편을 확인하지 않고 일방적으로 데이터를 전송하는 방식 (효율성 우선)
    - 동영상을 볼 때 주로 활용 (정확한 전송보다는 빠른 전송이 필요하기 때문)
    - UDP(User Datagram Protocol) 프로토콜

# TCP의 구조

- TCP 헤더: TCP로 전송할 때 붙이는 헤더
    - 이 TCP헤더가 붙은 데이터를 “세그먼트”라고 함.
    - 출발지 포트 번호 + 목적지 포트 번호 + 일련번호 + 확인 응답 번호 + 헤더 길이 + 예약 영역 + 코드 비트 + 윈도우 크기 + 체크섬 + 긴급 포인터 + 옵션
- 연결형 통신에서 데이터를 전송하기 전에 “연결(connection)”이라는 가상의 독점 통신로를 확보해야 한다.
    - 코드 비트의 SYN(연결 요청), ACK(확인 응답)가 필요
        - 코드 비트는 연결의 제어 정보가 기록된다. 초기값은 0이고 비트가 활성화되면 1
- 3-way 핸드셰이크: 데이터를 보내기 전에 연결을 확립하기 위해 패킷 요청을 세 번 교환하는 것

<aside>
🗣 1. 통신을 하려면 컴퓨터 2에게 허가를 받아야 하므로, 먼저 컴퓨터 1에서 컴퓨터 2로 연결 확립 허가를 받기 위한 요청(SYN)을 보낸다.
2. 컴퓨터 2는 컴퓨터1이 보낸 요청을 받은 후에 허가한다는 응답을 회신하기 위해 연결 확립 응답(ACK)을 보낸다. 동시에 컴퓨터 2도 컴퓨터 1에게 데이터 전송 허가를 받기 위해 연결 확립 요청(SYN)을 보낸다.
3. 컴퓨터 2의 요청을 받은 컴퓨터 1은 컴퓨터 2로 허가한다는 연결 확립 응답(ACK)을 보낸다.

</aside>

![Untitled](6%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%8C%E1%85%A5%E1%86%AB%E1%84%89%E1%85%A9%E1%86%BC%20%E1%84%80%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%BC%20%E1%84%89%E1%85%B5%E1%86%AB%E1%84%85%E1%85%AC%E1%84%92%E1%85%A1%E1%86%AF%20%E1%84%89%E1%85%AE%20%E1%84%8B%E1%85%B5%E1%86%BB%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%8C%E1%85%A5%E1%86%AB%E1%84%89%E1%85%A9%E1%86%BC%20924745c484f643ce990351b0a5cc8f8e/Untitled.png)

- 연결을 끊을 때는 FIN(연결 종료)와 ACK를 사용 (4-way handshake)

# 일련번호와 확인 응답 번호의 구조

- 3-way 핸드셰이크가 끝나고 실제로 데이터를 주고받을 때는 TCP헤더의 일련번호와 확인 응답 번호를 사용
- TCP는 데이터를 분할해서 보내는데 일련번호는 송신 측에서 수신 측에 ‘이 데이터가 몇 번째 데이터인지’ 알려줌
- 확인 응답 번호는 수신 측이 몇 번째 데이터를 수신했는지  송신 측에 알려줌. (확인 응답)
- 데이터가 항상 올바르게 전달되는 것은 아니므로 일련번호와 확인 응답 번호를 사용해서 데이터가 손상되거나 유실된 경우에 데이터를 재전송 (재전송 제어)
- 세그먼트(데이터) 하나를 보낼 때마다 확인 응답을 한번 반환하면 효율이 낮음.
    
    → 받은 세그먼트를 일시적으로 “버퍼”에 보관
    
    → 대량으로 데이터가 전송되면 보관하지도 못할 수도 있음 (오버플로우)
    
    → 오버플로가 발생하지 않도록 버퍼의 한계 크기를 알고 있어야 함! (윈도우 크기)
    
    - 3-way 핸드셰이크 과정에서 윈도우 크기를 확인

# 포트 번호의 구조

- 포트는 목적지가 어떤 애플리케이션인지 구분해주는 역할
- 포트번호는 0~65535번을 사용할 수 있음
    - 0~1023번 포트는 주요 프로토콜이 사용하도록 예약되어 있음 (well-known ports)
    - 1024번은 예약되어 있지만 사용되지는 않음
    - 1025번 이상은 클라이언트 측의 송신 포트로 사용 (랜덤 포트)
    - 웹 브라우저로 접속할 때 웹 브라우저에는 임의의 포트가 자동으로 할당
    
    → 서버 측에서는 포트 번호를 항상 정해 두어야 하지만 클라이언트 측은 그럴 필요 없음
    

# UDP의 구조

- UDP의 장점은 데이터를 효율적으로 빠르게 보내는 것
    - 스트림잉으로 전송하는 동영상 서비스와 같은 곳에 사용
- UDP에서는 UDP 헤더가 붙은 데이터를 UDP 데이터그램이라고 함.
    - 출발지 포트 번호 + 목적지 포트 번호 + 길이 + 체크섬
- 브로드캐스트(broadcast): UDP에서는 장비에 데이터를 일괄로 보낼 수 있음
- UDP에서의 브로드캐스트는 목적지에 관계없이 랜에서 일괄적으로 보내지만, TCP는 목적지를 지정하지 않으면 안되기 때문에 일괄통신이 불가능하다.