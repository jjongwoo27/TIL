# 4장 데이터 링크 계층 : 랜에서 데이터 전송하기

생성일: 2022년 1월 6일 오후 2:54
태그: 모두의Network

# 데이터 링크 계층의 역할과 이더넷

- 데이터 링크 계층은 네트워크 장비 간에 신호를 주고받는 규칙을 정하는 계층.
- 즉, 랜에서 데이터를 정상적으로 주고받기 위해 필요한 계층
    - 그 규칙들 중 일반적으로 가장 많이 사용되는 규칙이 이더넷(Ethernet)
- 이더넷은 허브와 같은 장비에 연결된 컴퓨터와 데이터를 주고받을 때 사용
- 이더넷은 여러 컴퓨터가 동시에 데이터를 전송해도 충돌이 일어나지 않도록 한다.
    - 데이터가 동시에 케이블을 지나가는 것을 막기 위해 데이터를 보내는 시점을 늦춤. (CSMA/CD)
    - CS : 데이터를 보내려고 하는 컴퓨터가 케이블에 신호가 흐르고 있는지 아닌지를 확인
    - MA : 케이블에 데이터가 흐르고 있지 않다면 데이터를 보내도 좋다
    - CD : 충돌이 발생하고 있는지를 확인
    - 그러나 지금은 효율이 좋지 않다는 이유로 이 방식을 사용하지 않고 “스위치”라는 네트워크 장비를 사용

# MAC 주소의 구조

- MAC(Media Access Control) 주소 : 랜카드에 새겨지는 물리주소로 전세계에서 유일한 번호로 할당
    - 48비트 숫자로 구성 - 앞쪽 24비트는 제조사번호 뒤쪽 24비트는 제조사가 부여한 일련번호
- OSI 데이터링크 계층, TCP/IP 네트워크 게층에서 이더넷 헤더와 트레일러를 붙임.
    - 이더넷 헤더 : 목적지 MAC 주소 (6바이트) + 출발지 MAC 주소 (6바이트) + 유형 (2바이트)
        - 이더넷 유형 : 이더넷으로 전송되는 상위 계층 프로토콜 16진수 번호 ex.IPv4, ARP, RARP, SNMP over Ethernet, IPv6
    - 트레일러(FCS, Frame Check Sequence) : 데이터 전송 도중에 오류가 발생하는지 확인
- 이더넷 헤더와 트레일러가 추가된 데이터를 “프레임”이라고 함. (”캡슐화”)

<aside>
🗣 송신 측 컴퓨터는 이더넷 헤더에 데이터의 목적지인 수신 측 컴퓨터의 MAC주소와 자신의 MAC주소 정보를 넣고 데이터를 전송한다. (캡슐화) 데이터 링크 계층에서 데이터에 이더넷 헤더와 트레일러를 추가하여 프레임을 만들고, 물리 계층에서 이 프레임 비트열을 전기신호로 변환하여 네트워크를 통해 전송한다. 허브는 이 데이터를 포트로 수신하고 모든 포트로 전송한다. 이때 목적지 MAC주소와 일치하지 않으면 데이터를 파기한다. 데이터를 받은 컴퓨터에서는 물리 계층에서 전기 신호로 전송된 데이터를 비트열로 변환하고 데이터 링크 계층에서 이더넷 헤더와 트레일러를 분리한다.(역캡슐화)

</aside>

- 컴퓨터들이 동시에 데이터를 전송할 경우 CSMA/CD 방식이 사용

# 스위치의 구조

- 스위치는 데이터 링크 계층에서 동작하고 Layer 2 스위치 또는 스위칭 허브라고도 불린다.
- 스위치 내부에는 “MAC 주소 테이블”이라는 것이 존재한다.
    - MAC 주소 테이블은 스위치의 포트 번호와 해당 포트에 연결되어 있는 컴퓨터의 MAC주소가 등록되는 데이터베이스.
- MAC주소 학습기능: 빈 데이베이스에 프레임을 전송받으면 MAC주소 테이블을 확인, 이때 이 MAC주소가 등록되어 있지 않으면 MAC주소를 포트와 함께 등록
- 플러딩(flooding): 데이터를 전송한 시점에 목적지 MAC주소가 MAC주소 테이블에 등록되어 있지 않아서 송신 포트 이외의 포트인 곳에 프레임이 전송되는 것.
- MAC주소 필터링 : MAC주소를 기준으로 목적지를 선택하여 불필요한 데이터를 네트워크에 전송하지 않게 함.

# 데이터가 케이블에서 충돌하지 않는 구조

- 전이중 통신과 반이중 통신
    - 전이중 통신 방식 : 데이터의 송수신을 동시에 통신하는 방식 → 충돌 x (스위치)
    - 반이중 통신 방식 : 회선 하나로 송신과 수신을 번갈아가면서 통신하는 방식 → 충돌 o (허브)
- 충돌 도메인 : 충돌이 발생할 때 그 영향이 미치는 범위
    - 허브의 경우 충돌의 영향이 모든 컴퓨터에 미친다. (반이증 통신 방식이므로)
    - 반면 스위치의 경우 영향이 한정적. (전이중 통신 방식이므로)

→ 스위치를 사용하자!

- ARP(Address Resolution Protocol): 목적지 컴퓨터의 IP주소를 이용하여 MAC주소를 찾기 위한 프로토콜
    - ARP 요청(Request): 출발지 컴퓨터가 목적지 주소를 모르면 MAC주소를 알아내기 위해 네트워크에 브로드캐스트를 함
    - ARP 응답(Reply): 지정된 IP주소를 가지고 있지 않은 컴퓨터는 응답하지 않고, 가지고 있는 컴퓨터는 MAC주소를 응답으로 보냄
    - ARP 테이블(Table): 출발지 컴퓨터에서는 MAC주소를 얻은 후에 MAC주소와 IP주소의 매핑 정보를 메모리에 보관 → 이후 데이터 통신은 ARP테이블을 참고하여 전송
    - 이때, ARP테이블에서는 보존 기간을 ARP캐시로 지정하고 일정 시간 지나면 삭제 후 다시 ARP 요청. (IP주소가 변경되어 MAC주소도 변경될 수도 있기 때문.)
    - 윈도에서 ARP캐시의 내용을 확인하려면 arp -a 명령어를 사용하고 강제로 삭제하려면 arp -d 명령어를 사용

# 이더넷의 종류와 특징

- 이더넷은 케이블 종류나 통신 속도에 따라 다양한 규격으로 분류
- 규격 이름은 “통신 속도(Mbps) + 전송방식 + 케이블”로 구성

ex) 10BASE5, 10BASE2, 10BASE-T, 100BASE-TX, 1000BASE-T, 10GBASE-T